document.addEventListener("DOMContentLoaded",(function(){llenarTablaTickets()}));const folio=document.querySelector("#idFolio"),asigna=document.querySelector("#idAsigna"),atiende=document.querySelector("#idAtiende"),fecha=document.querySelector("#idFecha"),requiere=document.querySelector("#idRequiere"),estado=document.querySelector("#idEstado"),clasificacion=document.querySelector("#idClasificacion"),subclasificacion=document.querySelector("#idSubclasificacion"),comentarios=document.querySelector("#idComentarios"),comentariosSoporte=document.querySelector("#idComentariosSoporte");function mostrarMesEnCurso(){var e=(new Date).getMonth()+1;const t=document.querySelector("#idFecha");t.addEventListener(),t.value=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][e-1]}function busqueda(){document.querySelector("#idfolio").addEventListener("keyup",kha)}async function llenarTablaTickets(){const e=document.querySelector(".tabla__body.tickets"),t=obtenerRol();try{const a=(await t).idRol,o="/api/obtenerTablaTickets",i=await fetch(o),l=await i.json();e.innerHTML="",l.forEach(t=>{const o=document.createElement("tr"),i=document.createElement("td"),l=document.createElement("td"),n=document.createElement("td"),c=document.createElement("td"),d=document.createElement("td"),s=document.createElement("td"),r=document.createElement("td"),u=document.createElement("td"),b=document.createElement("td"),_=document.createElement("td"),m=document.createElement("td"),f=document.createElement("DIV"),{idTicket:p,fechaCaptura:h,nombreAsigna:C,atiende:k,nombreRequiere:L,estadoTicket:E,clasificacion:y,subclasificacion:S,comentarios:v,comentariosSoporte:q}=t;o.classList.add("tabla__row"),h.split("-")[1]<10?h.split("-")[1][1]:h.split("-")[1],i.textContent=p,l.textContent=h.split("-")[2]+"/"+h.split("-")[1]+"/"+h.split("-")[0],n.textContent=C,c.textContent=k,d.textContent=L,s.textContent=E,r.textContent=y,u.textContent=S,b.textContent=v,_.textContent=q,i.classList.add("tabla__td"),l.classList.add("tabla__td"),n.classList.add("tabla__td"),c.classList.add("tabla__td"),d.classList.add("tabla__td"),s.classList.add("tabla__td"),r.classList.add("tabla__td"),u.classList.add("tabla__td"),b.classList.add("tabla__td"),_.classList.add("tabla__td"),m.classList.add("tabla__td"),f.classList.add("tabla__tickets--botones"),"4"===a&&f.classList.add("tabla__tickets--botones--colaborador"),f.innerHTML="<a href='/dashboard/historial-tickets?id="+p+"' title='Historial del ticket' class='tabla__boton-azul tabla__boton'><i class='fa-solid fa-clock fa-xl'></i></a>","1"!==a&&"2"!==a||("Abierto"===E||"Pausado"===E||"Escalado"===E?("Sin asignar"===k&&(f.innerHTML+="<a href='/dashboard/asignar-tickets?id="+p+"' title='Asignar ticket' class='tabla__boton-verde-limon tabla__boton'><i class='fa-solid fa-person-walking-arrow-loop-left fa-xl'></i></i></a>"),"Sin asignar"!==k&&(f.innerHTML+="<a href='/dashboard/pausar-tickets?id="+p+"' title='Pausar ticket' class='tabla__boton-gris tabla__boton'><i class='fa-solid fa-circle-pause fa-xl'></i></a>",f.innerHTML+="<a href='/dashboard/escalar-tickets?id="+p+"' title='Escalar ticket' class='tabla__boton-naranja tabla__boton'><i class='fa-solid fa-arrow-trend-up fa-xl'></i></a><a href='/dashboard/cerrar-tickets?id="+p+"'title='Cerrar ticket' class='tabla__boton-verde tabla__boton'><i class='fa-solid fa-circle-check fa-xl'></i></a>")):f.innerHTML+="<p class='tabla__cerrado'>Ticket cerrado</p>"),"3"===a&&("Abierto"!==E&&"Pausado"!==E&&"Escalado"!==E||(f.innerHTML+="<a href='/dashboard/pausar-tickets?id="+p+"' title='Pausar ticket' class='tabla__boton-gris tabla__boton'><i class='fa-solid fa-circle-pause fa-xl'></i></a><a href='/dashboard/cerrar-tickets?id="+p+"' title='Cerrar ticket' class='tabla__boton-verde tabla__boton'><i class='fa-solid fa-circle-check fa-xl'></i></a>")),o.appendChild(i),o.appendChild(l),o.appendChild(n),o.appendChild(c),o.appendChild(d),o.appendChild(s),o.appendChild(r),o.appendChild(u),o.appendChild(b),o.appendChild(_),m.appendChild(f),o.appendChild(m),e.appendChild(o)})}catch(e){console.log(e)}$(document).ready((function(){$(".filter").multifilter()}))}async function obtenerRol(){let e;try{const t="/api/obtenerEmpleadoRol",a=await fetch(t);e=await a.json()}catch(e){console.log(e)}return new Promise((t,a)=>t(e))}setInterval((function(){""===folio.value&&""===asigna.value&&""===atiende.value&&""===fecha.value&&""===requiere.value&&""===estado.value&&""===clasificacion.value&&""===subclasificacion.value&&""===comentarios.value&&""===comentariosSoporte.value&&llenarTablaTickets()}),2e3);